#    Copyright 2023 Australian Government Department of 
#    Climate Change, Energy, the Environment and Water
#
#    Licensed under the Apache License, Version 2.0 (the "License");
#    you may not use this file except in compliance with the License.
#    You may obtain a copy of the License at
#
#       https://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS,
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    See the License for the specific language governing permissions and
#    limitations under the License.
#    
test_that("weibull is unstable", {
  data <- data.frame(Conc = c(868.24508,
                              1713.82388,
                              3161.70678,
                              454.65412,
                              3971.75890,
                              37.69471,
                              262.14053,
                              363.20288,
                              1940.43277,
                              3218.05296,
                              77.48251,
                              1214.70521,
                              1329.27005,
                              1108.05761,
                              339.91458,
                              437.52104))
  
  fits <- ssd_fit_dists(data=data,
                        left = 'Conc', dists = c('gamma', 'weibull'),
                        silent = TRUE, reweight = FALSE, min_pmix = 0, nrow = 6L,
                        computable = TRUE, at_boundary_ok = FALSE, rescale = FALSE)
  
  # not sure why weibull dropping on some linux on github actions and windows
  # on other folks machines
  testthat::skip_on_ci()
  testthat::skip_on_cran()
  expect_identical(names(fits), c('gamma', 'weibull'))
})

test_that("hc multi_ci lnorm default 100", {
  fits <- ssd_fit_dists(ssddata::ccme_boron)
  set.seed(102)
  hc_average <- ssd_hc(fits, average = TRUE, ci = TRUE, nboot = 100, multi_ci = FALSE, multi_est = FALSE, samples = TRUE, weighted = FALSE)
  set.seed(102)
  hc_multi <- ssd_hc(fits, average = TRUE, multi_ci = TRUE, ci = TRUE, nboot = 100,
                     min_pboot = 0.8, samples = TRUE, weighted = FALSE)
  
  testthat::expect_snapshot({
    hc_average
  })
  
  # not sure why hc multi_ci is different on windows
  # ══ Failed tests ════════════════════════════════════════════════════════════════
  # ── Failure ('test-hc-root.R:77:3'): hc multi_ci lnorm default 100 ─────────────────
  # Snapshot of code has changed:
  #   old[4:7] vs new[4:7]
  # # A tibble: 1 x 10
  # dist    percent   est    se   lcl   ucl    wt method     nboot pboot
  # <chr>     <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <chr>      <dbl> <dbl>
  #   -   1 average       5  1.26 0.781 0.331  3.25     1 parametric   100  0.86
  #   +   1 average       5  1.26 0.769 0.410  3.25     1 parametric   100  0.86
  testthat::skip_on_ci() 
  testthat::skip_on_cran()
  testthat::expect_snapshot({
    hc_multi
  })
})

test_that("hp multi_ci lnorm default 100", {
  fits <- ssd_fit_dists(ssddata::ccme_boron)
  set.seed(102)
  hp_average <- ssd_hp(fits, average = TRUE, ci = TRUE, nboot = 100, multi_ci = FALSE, samples = TRUE, weighted = FALSE)
  set.seed(102)
  hp_multi <- ssd_hp(fits, average = TRUE, multi_ci = TRUE, ci = TRUE, nboot = 100,
                     min_pboot = 0.8, samples = TRUE, weighted = FALSE)
  
  testthat::expect_snapshot({
    hp_average
  })
  testthat::skip_on_ci() 
  testthat::skip_on_cran()
  # ── Failure ('test-hp-root.R:79:3'): hp multi_ci lnorm default 100 ─────────────────
  # Snapshot of code has changed:
  #   old[4:7] vs new[4:7]
  # # A tibble: 1 x 10
  # dist     conc   est    se   lcl   ucl    wt method     nboot pboot
  # <chr>   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <chr>      <dbl> <dbl>
  #   -   1 average     1  3.90  3.57 0.347  11.2     1 parametric   100  0.86
  #   +   1 average     1  3.90  2.89 0.347  11.2     1 parametric   100  0.86
  testthat::expect_snapshot({
    hp_multi
  })
})

test_that("gamma parameters are extremely unstable", {
  data <- ssddata::ccme_boron
  data$Other <- data$Conc
  data$Conc <- data$Conc / max(data$Conc)
  
  # gamma shape change from 913 to 868 on most recent version
  set.seed(102)
  fits <- ssd_fit_dists(data, dists = c("lnorm", "gamma"), right = "Other", rescale = FALSE, computable = FALSE)
  
  tidy <- tidy(fits)
  expect_s3_class(tidy, "tbl")
  testthat::skip_on_ci() # not sure why gamma shape is 908 on GitHub actions windows and 841 on GitHub actions ubuntu
  testthat::skip_on_cran()
  expect_snapshot_data(tidy, "tidy_gamma_unstable", digits = 1)
})


test_that("sgompertz completely unstable!", {
  skip_on_ci() # as incredibly unstable
  skip_on_cran()
  x <- c(
    3.15284072848962, 1.77947821504531, 0.507778085984185, 1.650387414067,
    1.00725113964435, 7.04244885481452, 1.32336941144339, 1.51533791792454
  )
  data <- data.frame(left = x, right = x, weight = 1)
  expect_snapshot({
    set.seed(94)
    ssdtools:::sgompertz(data)
    set.seed(99)
    ssdtools:::sgompertz(data)
  })
  set.seed(100)
  expect_error(ssdtools:::sgompertz(data))
})

test_that("sgompertz with initial values still unstable!", {
  skip_on_ci() # as incredibly unstable
  skip_on_cran()
  x <- c(
    3.15284072848962, 1.77947821504531, 0.507778085984185, 1.650387414067,
    1.00725113964435, 7.04244885481452, 1.32336941144339, 1.51533791792454
  )
  data <- data.frame(Conc = x)
  set.seed(11)
  expect_error(expect_warning(
    fit <- ssd_fit_dists(data, dists = "gompertz"),
    "Some elements in the working weights variable 'wz' are not finite"
  ))
  set.seed(21)
  expect_error(expect_warning(
    fit <- ssd_fit_dists(data, dists = "gompertz"),
    "L-BFGS-B needs finite values of 'fn'"
  ))
  set.seed(10)
  fit <- ssd_fit_dists(data, dists = "gompertz")
  
  sdata <- data.frame(left = x, right = x, weight = 1)
  pars <- estimates(fit$gompertz)
  
  expect_snapshot({
    set.seed(94)
    ssdtools:::sgompertz(sdata)
    set.seed(94)
    ssdtools:::sgompertz(sdata, pars)
    set.seed(99)
    ssdtools:::sgompertz(sdata)
    set.seed(99)
    ssdtools:::sgompertz(sdata, pars)
    set.seed(100)
    ssdtools:::sgompertz(sdata, pars)
  })
  set.seed(100)
  expect_error(ssdtools:::sgompertz(sdata))
})

test_that("sgompertz cant even fit some values", {
  skip_on_ci() # as incredibly unstable
  skip_on_cran()
  x <- c(160, 800, 840, 1500, 8200, 12800, 22000, 38000, 60900, 63000)
  expect_snapshot({
    ssdtools:::sgompertz(data.frame(left = x, right = x))
    ssdtools:::sgompertz(data.frame(left = rep(x,10), right = rep(x,10)))
    ssdtools:::sgompertz(data.frame(left = x, right = x), pars = c(12800, 1))
    ssdtools:::sgompertz(data.frame(left = x / 12800, right = x / 12800))
  },
  error = TRUE)
})


test_that("sgompertz cant even initialize lots of values", {
  skip_on_ci()
  skip_on_cran()
  x <- c(38.696580321462, 41.0167488906729, 39.5529154651536, 40.1225506655899, 
         38.2675196410126, 35.2169221089071, 37.8367285461107, 40.1377838232664, 
         37.5027912166191, 38.427368967798, 40.710857244717, 39.2107558513928, 
         38.8104318203955, 36.6782721298192, 39.1189629457727, 38.5038356599761, 
         40.9769905762875, 38.1358534539971, 37.677578277466, 37.0006299402988, 
         41.7135839580738, 40.1519559493184, 40.0672365990623, 39.5592247806773, 
         38.1637058572353, 39.8666688362276, 39.2503685118675, 38.9778749012123, 
         40.0217426884973, 37.5351699713108, 39.7893579120294, 39.2387926187296, 
         37.7044952991609, 37.8928752489645, 37.0090499173894, 38.4507445786794, 
         38.620077736605, 39.6020315346104, 39.7810679774789, 40.8150835920557, 
         37.9464980122296, 39.4069904913645, 38.0669287189795, 38.3441834518077, 
         38.1993919655101, 40.1628716902171, 40.0281770769124, 38.6956745583115, 
         39.6542719125524, 38.6088455182132, 39.8179004699168, 37.9230414720193, 
         39.867477710758, 38.9955567243247, 38.0169207342366, 40.3342027787477, 
         37.7344362972903, 38.6796129938263, 39.0965409517453, 41.46005663726, 
         37.0773600128194, 39.2487948784459, 39.2885683350943, 39.155662491164, 
         39.4144380892284, 37.8015034174506, 38.0318253811457, 39.2495131564861, 
         39.4079230863217, 37.8069359589137, 39.2240112827973, 39.7992027228957, 
         40.1464446475361, 38.0392748572373, 39.8704415381996, 37.0709840973726, 
         39.7109649144627, 34.6158405583583, 38.773189207226, 39.5879964831782, 
         37.2915278476584, 37.1687398705238, 39.8124336176356, 39.7309887182915, 
         40.4249042880422, 37.7747514337286, 39.5078848285084, 40.0854650060604, 
         38.4641772660282, 39.9580684236498, 39.0505656140191, 40.1090371065684, 
         40.2837137147484, 41.1777634956717, 37.1366808219419, 39.4525678965893, 
         38.6350146755692, 39.4979063158441, 41.3036446602384, 39.6926374930186, 
         40.3183234220183, 40.1679706298231, 39.701995572475, 38.6869017750228, 
         41.2896407864841, 38.7183693797009, 39.1452025170707, 38.3908637314772, 
         41.2694527496005, 38.8136900728032, 37.7645647745729, 36.5631366265512, 
         37.3667105678707, 41.7000277404458, 39.2707121440988, 36.6203610922647, 
         37.8168390843906, 38.0149455298419, 37.4344504136931, 39.4168634517092, 
         39.1022303484451, 40.7262981012178, 38.9244902124375, 39.7804365259938, 
         40.071593416537, 40.5326032455288, 40.2967188132833, 39.4709850594384, 
         39.7026879735608, 40.6767766734202, 39.8820157568733, 40.0306774727645, 
         39.206490542215, 37.7995176031058, 38.0305899072524, 41.2535959663767, 
         39.360970436801, 39.2050302399161, 37.9355199051284, 40.2662286603004, 
         41.121798879367, 37.1609962328165, 38.6466582748848, 38.8967782665257, 
         38.0404802796349, 38.376580403419, 38.6255759391397, 39.6073952243451, 
         37.6347924690042, 38.5132173119731, 38.8501436804498, 38.493737010245, 
         38.7589123929684, 39.7035807090811, 38.365423731158, 41.1023575551406, 
         39.4693407341018, 40.3775002176367, 40.0539303648849, 39.2793192634062, 
         38.8511551647368, 39.9553561650541, 38.2424584004309, 38.5571856715353, 
         37.8348991198805, 37.3717962287677, 39.4730584952921, 41.523488762831, 
         36.8499803076413, 38.013422735112, 37.4816695828213, 39.2621838289677, 
         38.9515538223032, 40.5502903474796, 39.1161030671012, 38.7945616870771, 
         40.2421942935249, 37.7346372472926, 39.1187706618842, 39.909833942905, 
         38.6548900463434, 34.9715389178589, 37.2873000101342, 37.9002061587514, 
         38.4975034197695, 42.1873757727254, 41.0764975000072, 38.7088995905531, 
         40.4662521529921, 40.9236134619865, 39.9786610218703, 39.0344464667416, 
         40.9923603178017, 38.226765970102, 36.0570644546613, 39.0610525309774, 
         39.378249772003, 39.8481492104, 38.8128557727509, 38.176560083666, 
         40.0109623940278, 38.365527279527, 41.4821313110713, 39.1562765062432, 
         38.6689781368494, 38.5153323903582, 38.9094460830558, 38.9146080159054, 
         39.5126736350809, 38.3551624615048, 39.2900471815049, 38.9872820902618, 
         40.4027625099742, 36.9621287876883, 40.3027289972827, 38.9177530641325, 
         38.8024677096201, 39.328858624352, 42.0770757806993, 38.1205541479795, 
         38.4547674083091, 39.1200982288705, 38.4720192141187, 39.8322429488103, 
         39.2862024373929, 39.7692289574389, 36.9552457155791, 38.8208389772751, 
         38.7085456704407, 38.179565545474, 38.9552962537617, 37.3170576915214, 
         37.9089935034163, 37.5515170524905, 40.8640899715991, 39.3977532271903, 
         40.6965393740808, 39.2099251528595, 40.3877351534164, 39.1571163215197, 
         38.8843000082186, 40.069135734553, 39.4155507502797, 40.0688390962823, 
         40.3694309505709, 38.0979381141079, 37.9653373751348, 39.7406945731137, 
         39.7319153561436, 41.0223207682689, 37.8004542927769, 40.2310555662633, 
         38.1240358129045, 38.2175347747922, 39.023415223749, 40.5585975447541, 
         37.0757803798169, 39.9840704053012, 37.1122869994015, 38.5234948115884, 
         39.1109096684222, 37.9292146217095, 38.8120641499639, 38.6725491967401, 
         38.4777632732966, 38.9945754893693, 39.541485148896, 39.133974747476, 
         38.2834898683667, 40.9802975141706, 39.3374507245175, 41.6661446806449, 
         38.4237943886002, 38.7813433440326, 39.9318339470732, 39.5304112157869, 
         37.2920210101965, 38.0332942356899, 42.1930139607762, 36.9890596297174, 
         39.9769160489512, 38.794454639375, 39.1341805428692, 40.484820544408, 
         39.6219550690723, 37.5200194925331, 37.7870770544869, 39.12031371933, 
         38.4395308986709, 39.1954131708967, 39.6642750370098, 39.7739948549039, 
         39.6011260967852, 38.6108656218676, 37.9154461005623, 38.8064624106545, 
         39.0597191615577, 35.5776144023631, 38.8748850476323, 43.9305705918234, 
         39.266027724492, 39.870215450819, 38.9148252560285, 38.8287721885671, 
         39.2737788275155, 39.4992532278209, 38.9122960388864, 37.9985552244301, 
         38.4433361268137, 37.9872056270947, 38.7829483316692, 40.4326071359729, 
         37.9718170571938, 37.3173504684119, 38.1041306072045, 39.431650255724, 
         39.6501134004123, 38.1962116855106, 40.2125593103105, 39.3300592733259, 
         38.4694436891443, 35.6018487136551, 37.7234340243789, 38.8416133651824, 
         40.1036196591042, 38.9598798772033, 40.3085817328287, 41.4975558278974, 
         38.2865459584346, 41.8260921139512, 40.3253160043853, 39.7726849675659, 
         37.5924692740547, 38.7610139093328, 37.2307592557815, 38.1224433823566, 
         39.7533625422114, 40.1702289131378, 39.5139069991125, 37.3763796206379, 
         43.6767194233294, 42.7980876063979, 40.0101004177844, 38.8045660097627, 
         38.7978864220019, 40.5196025015914, 39.6050801057401, 36.6941692064994, 
         40.2364242866681, 39.4308687797026, 36.1352625034067, 36.1265011734934, 
         40.326010741649, 41.3851869206732, 40.5747815072407, 40.1788259184253, 
         38.2380334879549, 34.0096690608054, 39.6929204766898, 39.9515741913088, 
         40.0041634169937, 37.9582791534962, 38.0335887840459, 39.1062032236527, 
         37.6651696793937, 39.6881044797558, 38.2690967830217, 40.130457062569, 
         38.6410808902146, 38.4676289901882, 39.1019005252714, 40.7213285577585, 
         37.9573767374336, 39.1183670846963, 38.3822026549756, 37.3646233094306, 
         39.1826303020084, 40.3572843581489, 38.442314623214, 38.5553027604022, 
         39.6068870521211, 39.8729613160067, 41.7122087547397, 40.0776416898586, 
         40.4393696960347, 39.3605590996253, 40.3260086548734, 40.1258507614127, 
         40.5186441923711, 38.9809155324387, 39.3394540102295, 39.975869633627, 
         40.3111919605064, 39.2163094429044, 38.8435899278059, 37.5259541950718, 
         36.963412513099, 39.7647281175532, 38.2778393335243, 38.9592447313249, 
         39.6832211664062, 39.8169965656146, 40.0571342866911, 40.0657728205233, 
         38.6334828058099, 40.2254110586556, 38.2941124576558, 39.7633820426071, 
         39.8812043275032, 39.5252167453337, 39.4841351687756, 37.0507474924108, 
         38.7234247192162, 39.6575948859279, 39.1826805828978, 38.0705317267602, 
         39.0896781744083, 40.4065177824407, 39.5646604953766, 39.3100515376255, 
         37.275038659114, 38.6217194765214, 39.5715251327988, 39.4358964492531, 
         37.8979324139364, 38.6842025210972, 38.9891069614657, 37.2435957040697, 
         39.4319370959362, 41.5303368473785, 39.2115622666226, 39.9039055064095, 
         38.5075815201747, 40.5302469191966, 39.7047799842818, 37.967366956652, 
         38.6211561846939, 40.4203269847067, 40.0927676792246, 37.6352896940885, 
         38.6602688775301, 40.1228354733954, 39.0484204031229, 40.241195037659, 
         37.9075743603001, 40.7096672855678, 40.2063979484382, 39.2988183828229, 
         38.7236306765055, 40.085046989671, 40.3864093200838, 39.2525922864072, 
         39.9833207861838, 39.4752029274992, 40.0888611984398, 38.8364314332866, 
         40.1768350426331, 37.6862394739334, 39.4665248116624, 37.899832276708, 
         40.3210047661294, 39.3284191247637, 38.2903729699707, 37.0554029584125, 
         38.0839523676974, 39.9998786189738, 39.2720100897009, 38.3885928001302, 
         40.9884814635961, 39.3736999451426, 39.0688349733752, 39.9805351538551, 
         38.2612231198234, 38.7808257073468, 40.4321639089165, 39.1925831801429, 
         38.161657993717, 39.4815364089669, 37.9936299742363, 38.1919733752425, 
         39.4634006258866, 40.6826647651456, 39.2383948920205, 38.8211139465359, 
         40.2361715640083, 39.2523254442209, 39.5614236208388, 36.3210627879153, 
         38.7634574724226, 39.9781094519548, 38.5720737088932, 39.0956252849711, 
         37.8334966329441, 37.2993457418318, 39.2514702470121, 39.8392558245568, 
         39.174775800502, 37.9748873577388, 43.8236675072905, 39.3897077144617, 
         37.5759557282776, 38.1069173479354, 37.4120299079579, 38.5163313919706, 
         38.8562534471793, 39.082731249183, 37.8123965517173, 38.6467206368035, 
         39.2624233039125, 38.0444904972806, 37.9813830943846, 38.9982977458439, 
         38.6337006206239, 36.0640324459786, 36.7986312761523, 38.020967310967, 
         40.7379364843796, 38.9806446447468, 38.6883329974466, 34.8276810946894, 
         37.7929643219164, 38.1936819030646, 38.8225376463523, 37.4761433823238, 
         38.5121448430208, 38.4575246789265, 38.858997572675, 38.359586766349, 
         39.558288704952, 40.4853848472591, 38.694323054342, 36.1844952800459, 
         38.4853690819966, 38.78881539253, 38.0197707602212, 37.7443143743366, 
         39.9711873308084, 38.9706104261925, 39.0769035054312, 39.459235288767, 
         36.7812361757565, 38.2369113062318, 39.3662625142971, 37.8482625397072, 
         38.6782247139701, 38.9567192145898, 38.2620419120765, 41.0626686610858, 
         38.6156436251503, 39.250379171601, 39.349946545355, 40.6275731605698, 
         37.9005995605111, 40.205914365087, 41.6982665619521, 39.3723235483688, 
         40.0347807170072, 39.497473475581, 38.6590218187837, 39.8843213213189, 
         38.6132703135293, 38.4280487105962, 38.5378818511143, 38.603135494208, 
         38.7561959541377, 39.3929216926093, 41.3597504191791, 38.6118918667787, 
         36.8411548739743, 39.3803349413986, 40.8109456694036, 39.3423162229158, 
         38.9459848320317, 39.4991104107462, 38.058197568962, 38.7725871889095, 
         39.1770615285156, 39.8193567350056, 38.2684201372059, 36.9811216392299, 
         40.1769004167604, 39.0216375952443, 40.9455713612591, 37.7742379317281, 
         38.7805197184278, 39.2973602139325, 41.0202595055836, 37.5888276948441, 
         39.6559437124032, 37.7993924072458, 36.8680224413153, 38.3929408217845, 
         39.313511789542, 36.8665331958893, 38.2182703654236, 38.8439109398027, 
         39.4111744274711, 39.9253017127809, 36.9237891082507, 36.7600893992139, 
         39.2855930848628, 39.2835843453872, 39.4129188137863, 37.9364834955805, 
         38.1476606393185, 37.2076006841655, 40.2747876086838, 37.9022020669638, 
         39.4325003205913, 37.951115432256, 37.807971401276, 40.2969281026145, 
         40.6730841209068, 39.2893414371149, 40.2741852515657, 39.764396697977, 
         38.4038572501277, 40.4955100450384, 39.7324796415345, 39.0789568290801, 
         39.0947744940562, 37.2667626452727, 40.9708061054478, 38.9398447906209, 
         38.6126752576927, 39.8159974079398, 39.4177867561836, 38.9876024433841, 
         40.794214437606, 43.7562402030798, 38.6701756334505, 38.1621099177722, 
         36.575698535627, 38.255188055226, 38.1033459720734, 37.0581351999275, 
         38.9359368996426, 39.7852493973811, 38.0872674708902, 41.8639370009924, 
         38.7447411439498, 39.3585499531425, 40.0256335982602, 38.6181510326272, 
         38.0178649059027, 38.1157132909286, 39.3558163810008, 38.8346645264899, 
         38.85461630796, 37.7248992534766, 38.863487092451, 39.015068997087, 
         40.0055219390627, 40.7027278313135, 39.5188006642669, 38.4928451553392, 
         39.1378385498179, 39.6115900842645, 37.8781421399288, 40.9844328121185, 
         39.403769365946, 40.0298671793341, 38.2239750135394, 39.7267400648407, 
         38.9995438518202, 40.2611538311266, 38.786793482844, 38.5653605190023, 
         33.9244604815106, 39.0096557979905, 40.6528672876171, 38.9818158286068, 
         38.8463968269336, 38.7436678863884, 37.975594403403, 38.4882244002132, 
         39.0343156180594, 46.9928676186891, 36.7781819074398, 39.8144638174003, 
         37.980464890335, 37.4564703569339, 40.1163325974914, 35.9871069681064, 
         39.68729235871, 40.630771351219, 38.9099007667918, 40.2818723062924, 
         40.4676556821653, 38.7747729933048, 38.9150973439876, 39.617266449505, 
         39.4126917827044, 38.8209524150646, 39.324579360117, 39.9107839860635, 
         40.0575447194271, 37.7686134706386, 39.2038472037554, 39.9940352077302, 
         37.3140594722784, 38.4796372751327, 39.6443079640486, 37.9232220261437, 
         41.2997001245465, 40.2407151320583, 37.5953456462041, 37.3782024981871, 
         39.4965108566101, 39.4310973372514, 40.9415421333551, 40.1267239148112, 
         39.0104802393511, 37.111403415285, 39.4666748528947, 37.6312986043052, 
         38.6648640776781, 39.4654162004083, 38.1723846390448, 38.7118913128723, 
         40.0394733411325, 40.1645364404523, 36.9445065042129, 38.6590138575, 
         37.2416738810632, 40.8946855580023, 38.9770037695946, 38.3977538832488, 
         39.4790250089449, 38.8075342559101, 39.2942139588824, 38.7240025841883, 
         38.8017025369415, 39.7585470282626, 39.5489808587065, 39.345956911995, 
         38.2287491973915, 39.0688696265457, 40.9548119905498, 38.7066227587173, 
         39.7386257214213, 40.129347373272, 41.4727756099533, 38.6855838540641, 
         39.7716702263939, 38.1691490705021, 40.292963019468, 39.6551387204093, 
         37.7531674165233, 38.7341956955806, 40.3685159751057, 38.0860567609003, 
         36.7305575128597, 37.530216757303, 35.8354709111472, 40.9933140599827, 
         38.0035814661196, 37.3354421128419, 36.8080737129569, 41.0985219440893, 
         38.8561139413136, 42.903710361809, 36.9954831637788, 38.531922153057, 
         42.2836921318667, 37.0028061885742, 40.6513942308223, 38.2096983818343, 
         38.0482194132477, 39.2607049466359, 38.8390235574544, 39.8576879080886, 
         37.8832792184292, 39.0034043277092, 38.684011442933, 38.9912312777927, 
         37.9757361394685, 41.3907600446042, 38.9312371532292, 37.7618971984968, 
         38.2894211481052, 39.6733277972708, 38.5658494550534, 40.1974937022928, 
         37.1473457893721, 38.8622864319329, 39.2725836058167, 38.0170971971996, 
         39.4898615875341, 39.366227898738, 37.339521745044, 38.8300803583305, 
         38.3411729217755, 39.1683817957122, 41.3070611199184, 38.4063260784734, 
         37.1340103791155, 39.362318928735, 40.5828795465779, 39.0971648173104, 
         39.3735811927919, 39.6792065372198, 40.3357320097854, 39.1127942705966, 
         38.8025678690956, 37.8528074490416, 40.3571246143704, 38.7236270643344, 
         39.3210878255258, 39.3417836462455, 37.7601030846554, 37.6883694697397, 
         39.5267272790581, 39.5195867118307, 43.0981559093668, 38.5628045416694, 
         38.1033275237512, 38.9833325135889, 37.8376076319414, 40.3895047883752, 
         37.3392863875083, 40.1192750487477, 37.8712505040228, 38.9730977144904, 
         38.7251809129993, 38.2959345065107, 38.765551878725, 36.5523814941017, 
         37.6999611725533, 40.112733295656, 38.8344276124878, 38.0256017350531, 
         40.8845820706635, 38.9226965106381, 37.2666634962291, 37.4203744638208, 
         40.7378152062249, 40.8809097806334, 38.6737692719535, 38.4747024652618, 
         39.3519738258198, 38.1086558072326, 38.8262025252141, 38.8373266870745, 
         40.6298259732028, 39.1767597684894, 35.8714031826228, 37.8534957833254, 
         37.7758645229045, 38.6631612922978, 38.7814973623979, 38.7338820404997, 
         39.0129989805106, 40.4871344567191, 39.8975251703063, 39.0078634209895, 
         39.2167315605367, 37.8803375793005, 40.3696161718203, 38.0337019843631, 
         38.7984476541142, 37.7595575940074, 38.6179730389926, 40.1986912298922, 
         41.2895593320579, 39.5060525497241, 39.0963392390911, 39.7313543995007, 
         38.8336169806451, 37.6823969764853, 39.3499446203202, 39.2649140853913, 
         38.0163632001511, 38.5959614053762, 40.2572217266411, 38.171698458165, 
         40.3008014086158, 39.6543735088728, 39.1815990861773, 39.8472544670532, 
         38.5977216059802, 39.9663605289933, 37.6893473908978, 38.8481549984134, 
         43.3766565048559, 39.3698770455496, 39.9415844625127, 39.5231925912406, 
         38.9189010640608, 37.0281041611697, 40.0940027447682, 39.5025949414688, 
         38.5149025776659, 40.1824657973457, 38.0594927655381, 37.3226089383971, 
         38.9757562397551, 39.4950417133679, 39.6859282232682, 39.7454876662063, 
         39.4851308978089, 40.1056769983355, 39.1589104415128, 39.0712831485648, 
         39.5607393847756, 39.0644583320816, 39.2515448674571, 39.3032359408323, 
         40.5479515450476, 39.6250139600485, 38.028139621913, 37.2285955574899, 
         37.2508387258539, 40.3846682207918, 38.636712625128, 39.4270502893468, 
         38.2057349544891, 40.4668369658496, 40.63076070518, 36.2667783526517, 
         38.5107950647274, 38.3743339825504, 37.7012252335452, 41.2805510262182, 
         38.4371011894573, 36.0375810764541, 37.7269181932527, 39.383489843013, 
         37.785445612894, 39.2808598910424, 40.5804682220679, 39.4633266713821, 
         40.9186377094679, 38.5959854428001, 38.3403967366083, 38.7686849587232, 
         38.3341640787877, 37.3980950685274, 35.6839274550542, 37.1841982128791, 
         39.3041223888912, 40.1800681285293, 38.5546795002772, 40.6649714235597, 
         39.3908892554947, 40.5295797705759, 41.2123065166508, 42.7254305446572, 
         38.4949631251763, 40.4935161618346, 38.5312798612271, 39.3479141908363, 
         37.8583779286256, 39.3390670518522, 35.0475174766598, 39.3317121842063, 
         39.291630780152, 39.8698771514366, 37.9858500799512, 40.8999515676964, 
         38.0316622823605, 38.8489839517514, 37.4775721757, 37.1104504954058, 
         39.8063713445244, 38.570827029856, 37.9436998244667, 39.8823824999909, 
         39.0937021503757, 40.090613185766, 39.6700607263025, 35.9614086936976, 
         38.1220240490322, 40.2313461100113, 38.493376737973, 37.8703435212788, 
         37.8464499387457, 37.2716605807549, 38.6150991186386, 39.1517243082324, 
         38.523443553638, 39.0255090270453, 38.5536830415702, 39.3734321577177, 
         40.3498997970709, 39.5379777035583, 36.2140501511744, 41.5758157855067, 
         39.371964604603, 38.4613550203525, 39.6530348500717, 36.2748047281009, 
         38.2783274778123, 38.6522833139846, 38.1808211976449, 38.2513083309745, 
         38.7109089141367, 39.7641821203552, 40.0028365411157, 38.1187417657084
  )
  expect_snapshot({
    set.seed(99)
    ssdtools:::sgompertz(data.frame(left = x, right = x))
    set.seed(99)
    ssd_fit_dists(data.frame(Conc = x), dists = "gompertz")
    set.seed(100)
    ssdtools:::sgompertz(data.frame(left = x, right = x))
    set.seed(100)
    ssd_fit_dists(data.frame(Conc = x), dists = "gompertz")
    set.seed(131)
    ssd_fit_dists(data.frame(Conc = x), dists = "gompertz")
  },
  error = TRUE)
})

test_that("ssd_hc cis with error", {
  skip_on_ci()
  skip_on_cran()
  
  set.seed(99)
  conc <- ssd_rlnorm_lnorm(30, meanlog1 = 0, meanlog2 = 1, sdlog1 = 1 / 10, sdlog2 = 1 / 10, pmix = 0.2)
  data <- data.frame(Conc = conc)
  fit <- ssd_fit_dists(data, dists = "lnorm_lnorm", min_pmix = 0.1)
  expect_identical(attr(fit, "min_pmix"), 0.1)
  expect_warning(hc_err <- ssd_hc(fit, ci = TRUE, min_pboot = 0.99, nboot = 100))
  expect_s3_class(hc_err, "tbl")
  expect_snapshot_data(hc_err, "hc_err_na")
  hc_err <- ssd_hc(fit, ci = TRUE, nboot = 100, min_pboot = 0.92, multi_ci = FALSE)
  expect_s3_class(hc_err, "tbl")
  expect_snapshot_data(hc_err, "hc_err")
})

test_that("ssd_hc comparable parametric and non-parametric big sample size", {
  skip_on_ci()
  skip_on_cran()
  
  set.seed(99)
  data <- data.frame(Conc = ssd_rlnorm(10000, 2, 1))
  fit <- ssd_fit_dists(data, dists = "lnorm")
  set.seed(10)
  hc_para <- ssd_hc(fit, ci = TRUE, nboot = 10, multi_ci = FALSE, samples = TRUE, weighted = FALSE)
  expect_snapshot_data(hc_para, "hc_para")
  set.seed(10)
  hc_nonpara <- ssd_hc(fit, ci = TRUE, nboot = 10, parametric = FALSE, multi_ci = FALSE, samples = TRUE, weighted = FALSE)
  expect_snapshot_data(hc_nonpara, "hc_nonpara")
})

test_that("ssd_hp cis with error", {
  skip_on_ci()
  skip_on_cran()
  
  set.seed(99)
  conc <- ssd_rlnorm_lnorm(30, meanlog1 = 0, meanlog2 = 1, sdlog1 = 1 / 10, sdlog2 = 1 / 10, pmix = 0.2)
  data <- data.frame(Conc = conc)
  fit <- ssd_fit_dists(data, dists = "lnorm_lnorm", min_pmix = 0.1)
  expect_identical(attr(fit, "min_pmix"), 0.1)
  expect_warning(hp_err <- ssd_hp(fit, conc = 1, ci = TRUE, nboot = 100, min_pboot = 0.99))
  expect_s3_class(hp_err, "tbl")
  expect_snapshot_data(hp_err, "hp_err_na")
  hp_err <- ssd_hp(fit, conc = 1, ci = TRUE, nboot = 100, min_pboot = 0.92, multi_ci = FALSE, weighted = FALSE)
  expect_s3_class(hp_err, "tbl")
  expect_snapshot_data(hp_err, "hp_err")
})

test_that("ssd_hp comparable parametric and non-parametric big sample size", {
  skip_on_ci()
  skip_on_cran()
  
  set.seed(99)
  data <- data.frame(Conc = ssd_rlnorm(10000, 2, 1))
  fit <- ssd_fit_dists(data, dists = "lnorm")
  set.seed(10)
  hp_para <- ssd_hp(fit, 1, ci = TRUE, nboot = 10, multi_ci = FALSE, samples = TRUE, weighted = FALSE)
  expect_snapshot_data(hp_para, "hp_para")
  set.seed(10)
  hp_nonpara <- ssd_hp(fit, 1, ci = TRUE, nboot = 10, parametric = FALSE, multi_ci = FALSE, samples = TRUE, weighted = FALSE)
  expect_snapshot_data(hp_nonpara, "hp_nonpara")
})

test_that("plot geoms", {
  skip_on_ci()
  skip_on_cran()
  
  gp <- ggplot2::ggplot(boron_pred) +
    geom_ssdpoint(data = ssddata::ccme_boron, ggplot2::aes(x = Conc)) +
    geom_ssdsegment(data = ssddata::ccme_boron, ggplot2::aes(x = Conc, xend = Conc * 2)) +
    geom_hcintersect(xintercept = 100, yintercept = 0.5) +
    geom_xribbon(
      ggplot2::aes(xmin = lcl, xmax = ucl, y = proportion),
      alpha = 1 / 3
    )
  expect_snapshot_plot(gp, "geoms_all")
})


test_that("ssd_plot censored data", {
  skip_on_ci()
  skip_on_cran()
  
  data <- ssddata::ccme_boron
  data$Other <- data$Conc * 2
  expect_snapshot_plot(ssd_plot(data, boron_pred, right = "Other", ribbon = TRUE), "boron_cens_pred_ribbon")
})

test_that("invpareto with extreme data", {
  skip_on_ci()
  skip_on_cran()
  
  data <- data.frame(Conc = c(
    2.48892649039671, 2.5258371156749, 2.51281264491458,
    2.49866046657748, 2.56572740160664, 2.49440006912093, 2.4817062813665,
    2.47546618759501, 2.53571697416386, 2.50242492575677, 2.50112253589808,
    2.5287786019635, 2.57780684900776, 2.53608336578284, 2.58101156958599,
    2.47461770234486, 2.49063194551244, 2.5856619890231, 2.48695693688166,
    2.57378026021983, 2.51235308389976, 2.48522032692049, 2.49973051106759,
    2.53625648406357, 2.51192819101941, 2.48564121012588, 2.47989185141965,
    2.47104478254847, 2.53704987914894, 2.48182203478124, 2.51943279158882,
    2.47875248023764, 2.52955571948405, 2.53413505298479, 2.4857126516631,
    2.55015093854307, 2.50566701101757, 2.5134323318284, 2.49793441210188,
    2.49424215906085, 2.48960347486455, 2.55358332496617, 2.55446292958609,
    2.48210193691792, 2.46945069890001, 2.48557684661491, 2.56460608968987,
    2.53708962699444, 2.48214951933889, 2.54412439394134, 2.59518068845417,
    2.55975671870397, 2.493434223589, 2.53455956396635, 2.49737837236316,
    2.54900643026637, 2.50513718347292, 2.54882879624245, 2.51814393193009,
    2.46420777049251, 2.46410824439861, 2.52375449633473, 2.50472480352834,
    2.47468853687034, 2.49903375287477, 2.51052484516152, 2.52440831022558,
    2.48241564711347, 2.57274003332032, 2.48966764017043, 2.5690823103684,
    2.50354051434315, 2.57783696959855, 2.55278129417344, 2.49091327122561,
    2.4858726676362, 2.50704022976757, 2.60120582374815, 2.48030852436464,
    2.58234455069583, 2.54629314447072, 2.52650700793897, 2.4871602238994,
    2.50569757079671, 2.49183442063104, 2.50165889380711, 2.47934668379978,
    2.47510756679179, 2.53369127110563, 2.46868451852079, 2.61321699644183,
    2.52987952199996, 2.58987810707128, 2.46777896999791, 2.51447342615507,
    2.48618482994608, 2.51794970929166, 2.49716394702713, 2.49218587262049
  ))
  
  fit99 <- ssd_fit_dists(data, dists = "invpareto")
  
  expect_equal(
    estimates(fit99),
    list(invpareto.weight = 1, invpareto.scale = 2.61422138795731, invpareto.shape = 26.0278618888663)
  )
})

test_that("not all estimates if fail", {
  skip_on_ci()
  skip_on_cran()
  
  dir <- withr::local_tempdir()
  
  fit <- ssd_fit_dists(ssddata::ccme_boron, dists = c("lnorm", "lnorm_lnorm"))
  set.seed(49)
  hc <- ssd_hc(fit, nboot = 10, ci = TRUE,
               parametric = TRUE, save_to = dir, min_pboot = 0.8, samples = TRUE)
  expect_snapshot_data(hc, "hc_notallestimates")
  expect_identical(list.files(dir), c("data_000000000_multi.csv", "data_000000001_multi.csv", "data_000000002_multi.csv", 
                                      "data_000000003_multi.csv", "data_000000004_multi.csv", "data_000000005_multi.csv", 
                                      "data_000000006_multi.csv", "data_000000007_multi.csv", "data_000000008_multi.csv", 
                                      "data_000000009_multi.csv", "data_000000010_multi.csv", "estimates_000000000_multi.rds", 
                                      "estimates_000000001_multi.rds", "estimates_000000002_multi.rds", 
                                      "estimates_000000003_multi.rds", "estimates_000000004_multi.rds", 
                                      "estimates_000000005_multi.rds", "estimates_000000006_multi.rds", 
                                      "estimates_000000007_multi.rds", "estimates_000000008_multi.rds",
                                      "estimates_000000009_multi.rds", "estimates_000000010_multi.rds"))
})

test_that("lnorm_lnorm fits anonb", {
  skip_on_ci()
  skip_on_cran()
  
  set.seed(99)
  data <- ssddata::anon_b
  fit <- ssd_fit_dists(data,
                       dists = c("lnorm_lnorm"),
                       at_boundary_ok = FALSE, min_pmix = 0.05
  )
  
  tidy <- tidy(fit)
  expect_snapshot_data(tidy, "tidy_anonb")
  expect_snapshot_plot(ssd_plot(data, predict(fit), ci = FALSE), "plot_anonb")
})

test_that("lnorm_lnorm non-bimodal 1000 data", {
  skip_on_ci()
  skip_on_cran()
  
  data <- data.frame(Conc = c(
    11.6635934627129, 11.3655834538171, 11.8239438136152, 11.4457330597547, 
    11.2733838979158, 11.6555694734405, 11.6077458629663, 11.6253179146231, 
    11.7565586590195, 11.1887570445131, 11.6730568277929, 11.4120070711133, 
    11.6824326010276, 11.3911357792784, 12.0706441525969, 11.2155412831347, 
    11.3821410267404, 11.3267141623621, 11.6076784146829, 11.3209976317701, 
    11.2959562378299, 11.6786188036454, 11.6046588017454, 11.7499647941354, 
    11.4831512412866, 11.8286883023093, 11.7007855177161, 11.6125285414713, 
    11.4368552322619, 11.677278735656, 11.2591724516819, 11.2122991922597, 
    11.2014592283697, 11.6757643041424, 11.3976039512326, 11.4064992756645, 
    11.6084844857244, 11.2659904100175, 11.4887603755147, 11.3465556328527, 
    11.6709507658488, 11.4442961944266, 11.6860922015911, 11.3337180713638, 
    11.4934336220037, 11.4237641215403, 11.2597374132061, 11.1767350574449, 
    11.5249429055911, 11.2922544242571, 11.3860745867636, 11.5766005475934, 
    11.2628237130449, 11.6146165920334, 11.4175020113036, 11.3195033621875, 
    11.1710952560318, 11.6597792510826, 11.4868152191465, 11.5721318552201, 
    11.6486854013223, 11.6404214031175, 11.4738473838758, 11.0370114162703, 
    11.5306291118776, 11.7547581342576, 11.1729582778396, 11.5752263994969, 
    11.2468730281413, 11.7327251393004, 11.6517053064323, 11.5377269190321, 
    11.7274750442181, 11.8998204906137, 11.6746453028613, 11.7144040978644, 
    11.3885625929466, 11.4727695225601, 11.5211563372212, 11.8779053238367, 
    11.5235380529653, 11.7352073567185, 11.778095222296, 11.5565087399718, 
    11.4303811869928, 11.411039568203, 11.7936208857429, 11.2632318149877, 
    11.4183636452509, 11.5450923312535, 11.5304172016656, 11.3564668458882, 
    11.3097786542072, 11.2559960803643, 11.1900205330239, 11.3179458681654, 
    11.5468393692064, 11.6109598609785, 11.4397968689957, 11.5829306616596, 
    11.4265533991304, 11.4037107783255, 11.6231069350061, 11.4476147809259, 
    11.315857500714, 11.192073498525, 11.1450028934144, 11.4763778673496, 
    11.3303593182416, 11.795851315237, 11.3154135776636, 11.504446981381, 
    11.3686452517911, 11.0681174567049, 11.9482203553029, 11.4990621721172, 
    11.7700827893035, 11.153277291342, 11.4103274908523, 11.362014739247, 
    11.3370793845089, 10.9490041292355, 11.5709887438907, 11.2392472207936, 
    11.4457697378538, 11.5518564381783, 11.1668497234251, 11.660217248224, 
    11.5408481305805, 11.3596525221312, 11.7088443068689, 11.0985982119481, 
    11.6344343224953, 11.5835918466228, 11.6707241606893, 11.4873075231587, 
    11.6871951877657, 11.3561777270116, 11.0926984591504, 11.6670973459339, 
    11.4743776164222, 11.4012126214713, 11.1670799989037, 11.3895862238313, 
    11.4619188035051, 11.7438466838695, 11.7789086710159, 11.8254153257148, 
    11.5350198406344, 11.614146101765, 11.5037937949341, 11.7594749216344, 
    11.7232424558103, 11.4901038034287, 11.457497322123, 11.4701475688988, 
    11.3495747129771, 11.4768364004515, 11.3536264552173, 11.6967872920671, 
    11.5958239935742, 11.8102460795176, 11.5285720139981, 11.5636360422529, 
    11.2391302305836, 11.6400828524342, 11.3649992872627, 11.7739800561355, 
    11.9514605248261, 11.8948860243831, 11.3298148207664, 11.3913235205135, 
    11.2842354326543, 11.5345139189297, 11.0970243900149, 11.7031563986728, 
    11.6634306349493, 11.9092830544344, 11.5869287303179, 11.7564461328616, 
    11.150172788247, 11.4822541140239, 11.4044323999418, 11.7430862177697, 
    11.4674029907269, 11.6087102680844, 11.0224410790094, 11.1429072494759, 
    11.1440714332214, 11.4429296944542, 11.5110545367456, 11.6902834560434, 
    11.975232188303, 11.3484533650323, 11.5902139993436, 11.6936184805547, 
    11.2156665797036, 11.5367845942098, 11.457685987964, 11.326091672857, 
    11.54310696694, 11.6318253757251, 11.4672564829417, 11.2753353731344, 
    11.5442624404976, 11.4998938095082, 11.7680718084146, 11.4432553497958, 
    11.7656381805778, 11.6559051931419, 11.2711880476245, 11.6412415650511, 
    11.5685922662603, 11.5506412075912, 11.3513987873333, 11.3315276655562, 
    11.335640654208, 11.681285272101, 11.5589662365603, 11.1828140877568, 
    11.5312581724757, 11.5432002402202, 11.7912888955701, 11.4905985999693, 
    11.1259591802745, 11.4610350884183, 11.7991160364597, 11.579099060573, 
    11.33449302326, 11.2554336598017, 11.4512378707303, 11.7226621454134, 
    11.3527354290433, 11.6705425125658, 11.5563556191945, 11.7308586023113, 
    11.9851397182973, 11.075885463439, 11.2080718893369, 11.4368799211954, 
    11.5632546318052, 11.6634278624019, 11.318215841977, 11.4880779444713, 
    11.6701760414542, 11.7900454830006, 11.4305509189927, 11.4005711273461, 
    11.493397563551, 11.3671831886506, 11.5455573847742, 11.455219607115, 
    11.3765307074504, 11.5322198186407, 11.7234429342707, 11.4913195141207, 
    11.5800460407405, 11.5015183797711, 11.600345452303, 11.671105482069, 
    11.9009180552352, 11.3047838103508, 11.243053789483, 11.3132995190247, 
    11.1839945545923, 11.5467528309238, 11.4624123336534, 11.4384084755489, 
    11.7624832869299, 11.4972069873588, 11.6718416090489, 11.5565193860913, 
    11.6854937630156, 11.486887701755, 11.2245408284927, 11.4223163757767, 
    11.6183353030888, 11.4781731819334, 11.4180676231011, 11.5222391679401, 
    10.9874586119541, 11.6315015151944, 11.6259231476061, 11.5246942987034, 
    11.3790143669854, 11.6091093097247, 11.8458505048798, 11.3956132241971, 
    11.4334989846648, 12.0107090576645, 11.58889471641, 11.8485588211996, 
    11.6912962865302, 11.3443567873428, 11.4889742885729, 11.7353556032995, 
    11.3458181845925, 11.5360487979571, 11.572996307097, 11.3900889967152, 
    11.3871286159282, 11.6394988106606, 11.6672892268697, 11.2499719224047, 
    11.4355438444653, 11.4146461074679, 11.5830061909034, 11.356416701344, 
    11.5194114268155, 11.4461730977868, 11.7555819598489, 11.757108193106, 
    11.6621065583231, 11.838582610051, 11.7632074437835, 11.3465420858875, 
    11.5844207003211, 11.1705821018384, 11.4142931889118, 11.6952187675352, 
    11.5853093436653, 11.3754738036731, 11.4897478077412, 11.6808486866119, 
    11.7782359379539, 11.4098989033173, 11.5147654815493, 11.9203595355564, 
    11.7863398442806, 11.6085439373772, 11.3748020550406, 11.5107499518156, 
    11.4459430122029, 11.8864880814917, 11.3910504966753, 11.7608068035471, 
    11.2010926856702, 11.2525270439525, 11.6862467158833, 11.732921172069, 
    11.2587015436406, 11.9648080240531, 11.2853204109666, 11.5145507471921, 
    11.4761721195894, 11.3591745195689, 11.6041308327816, 11.8698306010401, 
    11.6899433491951, 11.3939731110365, 11.5342338112757, 11.7752406163456, 
    11.435729513263, 11.3188712646992, 11.3365988682073, 11.6485204521932, 
    11.480686518043, 11.2799874465089, 11.4116754417375, 11.4545426647885, 
    11.5745481350434, 11.1966656568524, 11.6975132142541, 11.6431448445814, 
    11.2517604231283, 11.1486491517404, 11.6991734787903, 11.2241659658642, 
    11.4952691898267, 11.5740123918133, 11.3536512948081, 11.5378236053867, 
    11.5105640641999, 11.8221701602153, 11.2923902515628, 11.53180649897, 
    11.3691594548817, 11.6175646316642, 11.4053269282246, 11.234768393995, 
    11.641542054491, 11.7999676522794, 11.5257062424203, 11.5059110405551, 
    11.6617696764003, 11.3226243854653, 11.4880248762229, 11.7337176970954, 
    11.2155495826891, 11.6517450661497, 11.6021018262328, 11.3877604077526, 
    11.639890502846, 11.7809973315967, 11.3515596489177, 11.3761078301294, 
    11.4971577458201, 11.7264688656258, 11.4937265193511, 12.0486431731611, 
    11.4285135930375, 11.5266970229313, 11.6897298607594, 11.1325756698399, 
    11.3610403083483, 11.271158595137, 11.5987031218919, 11.2413020872383, 
    11.6922042998872, 11.0622291689558, 11.0493045662671, 11.7886726028345, 
    11.356875041002, 11.222682110044, 11.1729481428879, 12.050179976782, 
    11.3691912771854, 11.1729814065191, 11.6134550080208, 11.3668928620368, 
    11.2789813760573, 11.858752849499, 11.1277127982319, 11.2254664041385, 
    11.6425437286932, 11.5189911033846, 11.72792415931, 11.3460373137601, 
    11.4266246813696, 11.6145883108721, 11.4040865639135, 10.9397029690441, 
    11.9355220072695, 11.5659683736315, 11.2595351388416, 11.7264552315149, 
    11.4250232833136, 11.8505002503181, 11.6736025315652, 11.6358341743864, 
    11.4848620300854, 11.0658566253791, 11.7433762718265, 11.368863939374, 
    12.0430882282277, 11.1478992722267, 11.6529116138211, 11.4386231562301, 
    11.4699978508074, 11.3949217618572, 11.4546511662623, 11.6224432553423, 
    11.4421481785793, 11.657180874398, 12.8288174569032, 11.6252568763014, 
    11.491598965489, 11.5122204443171, 11.1946277176765, 11.3371665039755, 
    11.8219395858959, 11.4177551579925, 11.817401786082, 10.9066865497524, 
    11.6292423316714, 11.4345661115386, 11.5146335760661, 11.2164818600078, 
    11.6462007756576, 11.5594553161589, 11.2777294045852, 11.4064561143383, 
    11.403296101097, 11.1942695626537, 11.2069796841188, 11.5108806250445, 
    11.4903700781168, 11.4412637072806, 11.7367046978334, 11.4415759938265, 
    11.461789360977, 11.5025221397458, 11.6741375647481, 11.6318730203337, 
    11.8724788742072, 11.3411139466139, 11.193895333642, 11.5090212617708, 
    11.4766156814582, 11.3025257977669, 11.6887687898236, 11.9785619762261, 
    11.5832745795798, 11.5638848196105, 11.6373626595557, 11.5346618451343, 
    11.8053599896049, 11.7866836352087, 11.6656448470497, 11.6767793846651, 
    11.4386961150224, 11.6601979255714, 11.6835301301195, 11.1916085178821, 
    11.3638143635823, 11.5384570024637, 11.5021355520758, 11.728807679399, 
    10.984378479658, 11.7213214603164, 10.7461781085464, 11.3870533808756, 
    11.6264922619532, 11.5206029097705, 11.3075447476347, 11.5292525213332, 
    11.4474539160496, 11.1784758708234, 11.3896979535097, 11.719541623793, 
    11.6053073443453, 11.518232072859, 11.3712640382737, 11.6098940705145, 
    11.5382560364661, 11.7993666879693, 11.6324840910319, 11.4481893420571, 
    11.541204261907, 11.5773112599797, 11.5737901104302, 11.4341925128839, 
    11.4793732048958, 11.6786469969964, 11.779820125404, 11.531459246292, 
    11.2534419833243, 11.5242285802331, 11.7505344377909, 11.2561748020822, 
    11.4661314501832, 11.4760530705387, 11.4506126062349, 11.3963732165445, 
    11.4312630670097, 11.3557616131191, 11.5823565060607, 11.5363888326256, 
    11.4917903826409, 11.5703392588785, 11.4208903235975, 11.3264983504393, 
    11.4339118777607, 11.6207177601068, 12.0732854180863, 11.3485270565549, 
    11.7214183450559, 11.3500282028636, 11.2190693389911, 11.2069248306124, 
    11.6847250769785, 11.7484631837051, 11.3928718561409, 11.0483431329695, 
    11.0632555553734, 11.3484711276532, 11.3540665678888, 11.424901501236, 
    11.3772438391331, 11.3402755457535, 11.6658488666932, 11.801777190057, 
    11.2024789759482, 11.2178942545725, 11.4553053426658, 11.7871905188347, 
    11.4981479663863, 11.327302970811, 11.4159310930165, 11.5560442202663, 
    11.7365037432332, 11.3378278539107, 11.8208625963249, 11.6497566272874, 
    11.5075152494812, 11.5215250880463, 11.2812669600297, 11.310753285262, 
    11.9620678652502, 11.3590587863734, 11.3898381131715, 11.2529331118846, 
    11.2362185790092, 11.385351174977, 11.5744685353361, 11.4856804686762, 
    11.913912055332, 11.3767849155427, 11.8094735607357, 11.1508024267808, 
    11.8106804361006, 11.5470001967063, 11.3952593838908, 11.2484965135934, 
    11.1152705518813, 11.5389406080853, 11.7634503537939, 11.4291028317061, 
    11.3276572999105, 11.4930118360099, 11.5469649014856, 11.5169350020809, 
    11.3285353226113, 11.2780234904709, 11.440289000834, 11.220111220716, 
    11.6368461254189, 11.3373985461442, 11.5729909942026, 11.5627913514537, 
    11.896010438462, 12.1378927192053, 11.2661668881932, 11.6500397905937, 
    11.9456515880464, 11.6036046289927, 11.2617034688574, 11.2041718173304, 
    11.7846555949065, 11.7468241221256, 11.5711643637382, 11.4605756512852, 
    11.6855846792033, 11.610560314245, 11.4023298726094, 11.5935010737646, 
    11.4794267316669, 11.4177936724899, 11.3170444087192, 11.4297981291346, 
    11.5846912793348, 11.5361273182454, 11.2836990730896, 11.7129292407643, 
    11.3682617291422, 11.5788574326573, 11.3656467657476, 11.4105589568224, 
    11.6329782469737, 11.7741760320124, 11.5877677859266, 11.4614478490663, 
    11.8922989610443, 11.4769174598707, 11.5473094994925, 11.8164122469798, 
    11.3965297469094, 11.7060351811225, 11.9160697996983, 12.2091231955421, 
    11.4513840897352, 11.9190686799799, 11.5716373917844, 11.4552839479779, 
    11.2069385588086, 11.2352938786398, 11.4799962344234, 11.1715703387231, 
    11.5951806551894, 11.4965967805174, 11.9066684684352, 12.085620305792, 
    11.6762460737526, 11.5003622406498, 11.2467259944484, 11.3576209222196, 
    11.5538967776043, 11.6021728438367, 11.4017677191272, 11.6541203471886, 
    11.5179908661979, 11.3731766103249, 11.284667844589, 11.277379710151, 
    11.6083662721441, 11.4137354186957, 10.8955839097348, 11.6128481523168, 
    10.9414889550394, 11.500934449099, 11.4032494506259, 11.3414275766532, 
    11.6103518032939, 11.4489716827269, 11.4521528606091, 11.4586955357924, 
    11.0442737725854, 11.4024077316865, 11.4530826810189, 11.2142229985889, 
    11.3211367494156, 11.7695143207915, 11.6801094326193, 11.378714542138, 
    11.5894285425463, 11.4535592112896, 11.5189077909302, 11.905529468508, 
    11.7308595111171, 11.1561241580823, 11.5396607072055, 11.5670558138667, 
    11.5866534877845, 11.4899696625367, 10.7606650890848, 11.4623034225546, 
    11.4829861663367, 11.531027241558, 11.1284027924671, 11.3789406141285, 
    11.7180842406464, 11.248060386135, 11.8557680503442, 11.4749711791423, 
    11.7731267020686, 11.4451020052469, 11.5536039362763, 11.2295030702308, 
    11.4439680242462, 11.3599366494965, 11.2375779084626, 11.4027090068517, 
    11.4674002049422, 11.6107908879673, 11.3646653036025, 11.3525677125419, 
    11.6956920927681, 11.5949761789213, 11.4279470409673, 11.628194983154, 
    11.3797989564061, 11.4537211190876, 11.544720822699, 11.3477447726164, 
    11.5106910979557, 11.2705155562627, 11.5419354593303, 11.6002427009366, 
    11.3617284216845, 11.4545380023049, 11.5559785868196, 11.2827575037312, 
    11.4923949055435, 11.4670902548463, 11.7775808724294, 11.7524650925602, 
    11.5232395955812, 11.7716348213617, 11.3129441491383, 11.9184159519933, 
    11.4651302298193, 11.4828115364529, 11.4921553448102, 11.4840394509425, 
    11.4795329119155, 11.3557617727837, 11.1990802135024, 11.555895890632, 
    11.5665334157256, 11.9608405697218, 11.0906137231452, 11.4738335300962, 
    11.5552267798845, 11.4917532448646, 11.4767501205378, 11.309257136722, 
    11.8330397760739, 11.2452007264035, 11.5626653665188, 11.6615348431299, 
    11.4036383205713, 11.9206466284402, 11.4028117349485, 11.232335830704, 
    11.5710019223606, 11.2323436049941, 11.0986236955492, 11.7618238628064, 
    11.3445348352561, 11.378093136043, 11.5381912190455, 11.282570495449, 
    11.3186759511659, 11.4117838917907, 11.6227635225452, 11.7844213221872, 
    11.5671587969278, 11.458922182513, 11.4032992701995, 11.5491884538217, 
    11.2758671228542, 11.6770897492982, 11.6342313067151, 11.1237574188463, 
    11.6031081273673, 12.1290653063871, 11.4778345922648, 11.3583463804655, 
    11.3266052031506, 11.7246123353123, 11.4647737955044, 11.5883332972292, 
    11.4248310030985, 11.3713918308266, 11.2041509548359, 11.617616628905, 
    11.3759381668148, 11.3305920225639, 11.6871369457011, 11.6303021419011, 
    11.4931674583361, 11.0922966074434, 11.2490842937364, 10.9403583083204, 
    11.1716989237958, 11.4292855836507, 11.6236233194597, 11.5989208423244, 
    11.2147889962406, 11.625607143598, 11.8748838328963, 11.5414934062674, 
    11.6259439615824, 11.3364532857374, 11.8227344400673, 11.7111666222959, 
    11.3727104334305, 11.7078155455392, 11.5544569070194, 11.6021540153749, 
    11.573369065866, 10.8581859655439, 11.6615357936139, 11.6074293122824, 
    11.3800328287919, 11.8608121046055, 10.8695335671074, 11.4549460213617, 
    11.6732793086444, 11.6280582434249, 11.7938110746401, 11.2759355094693, 
    11.7333174374389, 11.5124908292672, 11.5116966042338, 11.2557414497685, 
    11.111003192477, 11.7723687553069, 11.5311536361956, 11.415675250247, 
    11.434958888026, 11.5764304335137, 11.3184428704269, 11.5925005193847, 
    11.6606221243124, 11.6799864503813, 11.6680624812246, 11.6323392171622, 
    11.6205668223306, 11.2743893579799, 11.3038169041637, 11.2516179608122, 
    11.0913550278671, 11.5183036046645, 11.6088540037091, 11.4237385957101, 
    11.7411183714493, 11.5268255736499, 11.5514313428383, 11.4939244996735, 
    11.478671143305, 11.5506137782508, 11.4838342763386, 11.9082590797765, 
    10.960554474782, 11.4510734836701, 11.594720494906, 11.6435287600618, 
    11.4730994130636, 11.6753147493462, 11.0704918909154, 11.3363906264414, 
    11.4069381361204, 11.3390189388972, 11.7394581174949, 11.5025933598415, 
    11.5091568374427, 11.8189657846627, 11.6762535202989, 11.4862855869735, 
    11.5191142470272, 11.4087780398663, 11.5361396738411, 11.3477626341929, 
    11.3295447034612, 11.6461819581215, 11.3160562372171, 11.9732839905477, 
    11.2597545419879, 11.6483236285684, 11.6659329899876, 11.3375985127992, 
    11.5652927769658, 11.5402126667346, 11.5246347656743, 11.3790534415256, 
    11.3504467491437, 11.9006774473653, 11.2998434728114, 11.294215001317, 
    11.0352592725904, 11.5442750193934, 11.9540286929111, 11.5849472177449, 
    11.8695269797079, 11.2221940781463, 11.5391494901798, 11.7652998758852, 
    11.7152214736869, 11.6161349733777, 11.3455362974154, 11.3697013696593, 
    11.6159930311664, 11.5192522836597, 11.3626732407949, 11.7915655615128, 
    10.8468085570926, 11.5051760134024, 11.3931245756523, 11.6445146662936, 
    11.3470732268861, 11.6515019252136, 11.5141257439709, 11.2773011669151, 
    11.3032998105644, 11.7571007839257, 11.3544692125066, 11.5818232930408, 
    11.0839805881239, 11.8582789073051, 11.5997729156958, 11.5897058738691, 
    11.4193569373722, 11.8678858552685, 11.6051915096343, 11.3371558507094, 
    11.3210764775439, 11.3670660935708, 10.9736909230005, 11.5134036283058, 
    11.7378869878075, 11.6101540643963, 11.5960760408688, 11.5398373831802, 
    11.6921293527264, 11.0056293583308, 11.3779618825627, 11.4358858630188, 
    11.3398108548088, 11.500395429923, 11.6290788048495, 11.4534379910937, 
    11.3973526125132, 11.8090228812056, 11.4349697688751, 11.4120105561733, 
    11.2768023713792, 11.6479180048227, 11.8538348852147, 11.2816551787507, 
    11.5483270246353, 11.5002183838825, 11.3020898934751, 11.5115149415805, 
    11.2017560031151, 11.352225955946, 11.6826296693967, 11.8553332139932, 
    11.9042883574032, 11.0560549115389, 11.1767099828818, 11.421709850191, 
    11.702545464272, 11.7485923966285, 11.8047860348248, 11.4448541804893, 
    11.4705435703147, 11.716935272144, 10.9954029806633, 11.1256601239288
  ))
  fit <- ssd_fit_dists(data = data, dists = 'lnorm_lnorm', at_boundary_ok=TRUE)
  tidy <- tidy(fit)
  expect_snapshot_data(tidy, "tidy_lnorm_lnorm_uni1000", digits = 3)
})

test_that("lnorm_lnorm non-bimodal 1000 data", {
  skip_on_ci()
  skip_on_cran()
  
  data <- data.frame(Conc = c(
    11.6635934627129, 11.3655834538171, 11.8239438136152, 11.4457330597547, 
    11.2733838979158, 11.6555694734405, 11.6077458629663, 11.6253179146231, 
    11.7565586590195, 11.1887570445131, 11.6730568277929, 11.4120070711133, 
    11.6824326010276, 11.3911357792784, 12.0706441525969, 11.2155412831347, 
    11.3821410267404, 11.3267141623621, 11.6076784146829, 11.3209976317701, 
    11.2959562378299, 11.6786188036454, 11.6046588017454, 11.7499647941354, 
    11.4831512412866, 11.8286883023093, 11.7007855177161, 11.6125285414713, 
    11.4368552322619, 11.677278735656, 11.2591724516819, 11.2122991922597, 
    11.2014592283697, 11.6757643041424, 11.3976039512326, 11.4064992756645, 
    11.6084844857244, 11.2659904100175, 11.4887603755147, 11.3465556328527, 
    11.6709507658488, 11.4442961944266, 11.6860922015911, 11.3337180713638, 
    11.4934336220037, 11.4237641215403, 11.2597374132061, 11.1767350574449, 
    11.5249429055911, 11.2922544242571, 11.3860745867636, 11.5766005475934, 
    11.2628237130449, 11.6146165920334, 11.4175020113036, 11.3195033621875, 
    11.1710952560318, 11.6597792510826, 11.4868152191465, 11.5721318552201, 
    11.6486854013223, 11.6404214031175, 11.4738473838758, 11.0370114162703, 
    11.5306291118776, 11.7547581342576, 11.1729582778396, 11.5752263994969, 
    11.2468730281413, 11.7327251393004, 11.6517053064323, 11.5377269190321, 
    11.7274750442181, 11.8998204906137, 11.6746453028613, 11.7144040978644, 
    11.3885625929466, 11.4727695225601, 11.5211563372212, 11.8779053238367, 
    11.5235380529653, 11.7352073567185, 11.778095222296, 11.5565087399718, 
    11.4303811869928, 11.411039568203, 11.7936208857429, 11.2632318149877, 
    11.4183636452509, 11.5450923312535, 11.5304172016656, 11.3564668458882, 
    11.3097786542072, 11.2559960803643, 11.1900205330239, 11.3179458681654, 
    11.5468393692064, 11.6109598609785, 11.4397968689957, 11.5829306616596, 
    11.4265533991304, 11.4037107783255, 11.6231069350061, 11.4476147809259, 
    11.315857500714, 11.192073498525, 11.1450028934144, 11.4763778673496, 
    11.3303593182416, 11.795851315237, 11.3154135776636, 11.504446981381, 
    11.3686452517911, 11.0681174567049, 11.9482203553029, 11.4990621721172, 
    11.7700827893035, 11.153277291342, 11.4103274908523, 11.362014739247, 
    11.3370793845089, 10.9490041292355, 11.5709887438907, 11.2392472207936, 
    11.4457697378538, 11.5518564381783, 11.1668497234251, 11.660217248224, 
    11.5408481305805, 11.3596525221312, 11.7088443068689, 11.0985982119481, 
    11.6344343224953, 11.5835918466228, 11.6707241606893, 11.4873075231587, 
    11.6871951877657, 11.3561777270116, 11.0926984591504, 11.6670973459339, 
    11.4743776164222, 11.4012126214713, 11.1670799989037, 11.3895862238313, 
    11.4619188035051, 11.7438466838695, 11.7789086710159, 11.8254153257148, 
    11.5350198406344, 11.614146101765, 11.5037937949341, 11.7594749216344, 
    11.7232424558103, 11.4901038034287, 11.457497322123, 11.4701475688988, 
    11.3495747129771, 11.4768364004515, 11.3536264552173, 11.6967872920671, 
    11.5958239935742, 11.8102460795176, 11.5285720139981, 11.5636360422529, 
    11.2391302305836, 11.6400828524342, 11.3649992872627, 11.7739800561355, 
    11.9514605248261, 11.8948860243831, 11.3298148207664, 11.3913235205135, 
    11.2842354326543, 11.5345139189297, 11.0970243900149, 11.7031563986728, 
    11.6634306349493, 11.9092830544344, 11.5869287303179, 11.7564461328616, 
    11.150172788247, 11.4822541140239, 11.4044323999418, 11.7430862177697, 
    11.4674029907269, 11.6087102680844, 11.0224410790094, 11.1429072494759, 
    11.1440714332214, 11.4429296944542, 11.5110545367456, 11.6902834560434, 
    11.975232188303, 11.3484533650323, 11.5902139993436, 11.6936184805547, 
    11.2156665797036, 11.5367845942098, 11.457685987964, 11.326091672857, 
    11.54310696694, 11.6318253757251, 11.4672564829417, 11.2753353731344, 
    11.5442624404976, 11.4998938095082, 11.7680718084146, 11.4432553497958, 
    11.7656381805778, 11.6559051931419, 11.2711880476245, 11.6412415650511, 
    11.5685922662603, 11.5506412075912, 11.3513987873333, 11.3315276655562, 
    11.335640654208, 11.681285272101, 11.5589662365603, 11.1828140877568, 
    11.5312581724757, 11.5432002402202, 11.7912888955701, 11.4905985999693, 
    11.1259591802745, 11.4610350884183, 11.7991160364597, 11.579099060573, 
    11.33449302326, 11.2554336598017, 11.4512378707303, 11.7226621454134, 
    11.3527354290433, 11.6705425125658, 11.5563556191945, 11.7308586023113, 
    11.9851397182973, 11.075885463439, 11.2080718893369, 11.4368799211954, 
    11.5632546318052, 11.6634278624019, 11.318215841977, 11.4880779444713, 
    11.6701760414542, 11.7900454830006, 11.4305509189927, 11.4005711273461, 
    11.493397563551, 11.3671831886506, 11.5455573847742, 11.455219607115, 
    11.3765307074504, 11.5322198186407, 11.7234429342707, 11.4913195141207, 
    11.5800460407405, 11.5015183797711, 11.600345452303, 11.671105482069, 
    11.9009180552352, 11.3047838103508, 11.243053789483, 11.3132995190247, 
    11.1839945545923, 11.5467528309238, 11.4624123336534, 11.4384084755489, 
    11.7624832869299, 11.4972069873588, 11.6718416090489, 11.5565193860913, 
    11.6854937630156, 11.486887701755, 11.2245408284927, 11.4223163757767, 
    11.6183353030888, 11.4781731819334, 11.4180676231011, 11.5222391679401, 
    10.9874586119541, 11.6315015151944, 11.6259231476061, 11.5246942987034, 
    11.3790143669854, 11.6091093097247, 11.8458505048798, 11.3956132241971, 
    11.4334989846648, 12.0107090576645, 11.58889471641, 11.8485588211996, 
    11.6912962865302, 11.3443567873428, 11.4889742885729, 11.7353556032995, 
    11.3458181845925, 11.5360487979571, 11.572996307097, 11.3900889967152, 
    11.3871286159282, 11.6394988106606, 11.6672892268697, 11.2499719224047, 
    11.4355438444653, 11.4146461074679, 11.5830061909034, 11.356416701344, 
    11.5194114268155, 11.4461730977868, 11.7555819598489, 11.757108193106, 
    11.6621065583231, 11.838582610051, 11.7632074437835, 11.3465420858875, 
    11.5844207003211, 11.1705821018384, 11.4142931889118, 11.6952187675352, 
    11.5853093436653, 11.3754738036731, 11.4897478077412, 11.6808486866119, 
    11.7782359379539, 11.4098989033173, 11.5147654815493, 11.9203595355564, 
    11.7863398442806, 11.6085439373772, 11.3748020550406, 11.5107499518156, 
    11.4459430122029, 11.8864880814917, 11.3910504966753, 11.7608068035471, 
    11.2010926856702, 11.2525270439525, 11.6862467158833, 11.732921172069, 
    11.2587015436406, 11.9648080240531, 11.2853204109666, 11.5145507471921, 
    11.4761721195894, 11.3591745195689, 11.6041308327816, 11.8698306010401, 
    11.6899433491951, 11.3939731110365, 11.5342338112757, 11.7752406163456, 
    11.435729513263, 11.3188712646992, 11.3365988682073, 11.6485204521932, 
    11.480686518043, 11.2799874465089, 11.4116754417375, 11.4545426647885, 
    11.5745481350434, 11.1966656568524, 11.6975132142541, 11.6431448445814, 
    11.2517604231283, 11.1486491517404, 11.6991734787903, 11.2241659658642, 
    11.4952691898267, 11.5740123918133, 11.3536512948081, 11.5378236053867, 
    11.5105640641999, 11.8221701602153, 11.2923902515628, 11.53180649897, 
    11.3691594548817, 11.6175646316642, 11.4053269282246, 11.234768393995, 
    11.641542054491, 11.7999676522794, 11.5257062424203, 11.5059110405551, 
    11.6617696764003, 11.3226243854653, 11.4880248762229, 11.7337176970954, 
    11.2155495826891, 11.6517450661497, 11.6021018262328, 11.3877604077526, 
    11.639890502846, 11.7809973315967, 11.3515596489177, 11.3761078301294, 
    11.4971577458201, 11.7264688656258, 11.4937265193511, 12.0486431731611, 
    11.4285135930375, 11.5266970229313, 11.6897298607594, 11.1325756698399, 
    11.3610403083483, 11.271158595137, 11.5987031218919, 11.2413020872383, 
    11.6922042998872, 11.0622291689558, 11.0493045662671, 11.7886726028345, 
    11.356875041002, 11.222682110044, 11.1729481428879, 12.050179976782, 
    11.3691912771854, 11.1729814065191, 11.6134550080208, 11.3668928620368, 
    11.2789813760573, 11.858752849499, 11.1277127982319, 11.2254664041385, 
    11.6425437286932, 11.5189911033846, 11.72792415931, 11.3460373137601, 
    11.4266246813696, 11.6145883108721, 11.4040865639135, 10.9397029690441, 
    11.9355220072695, 11.5659683736315, 11.2595351388416, 11.7264552315149, 
    11.4250232833136, 11.8505002503181, 11.6736025315652, 11.6358341743864, 
    11.4848620300854, 11.0658566253791, 11.7433762718265, 11.368863939374, 
    12.0430882282277, 11.1478992722267, 11.6529116138211, 11.4386231562301, 
    11.4699978508074, 11.3949217618572, 11.4546511662623, 11.6224432553423, 
    11.4421481785793, 11.657180874398, 12.8288174569032, 11.6252568763014, 
    11.491598965489, 11.5122204443171, 11.1946277176765, 11.3371665039755, 
    11.8219395858959, 11.4177551579925, 11.817401786082, 10.9066865497524, 
    11.6292423316714, 11.4345661115386, 11.5146335760661, 11.2164818600078, 
    11.6462007756576, 11.5594553161589, 11.2777294045852, 11.4064561143383, 
    11.403296101097, 11.1942695626537, 11.2069796841188, 11.5108806250445, 
    11.4903700781168, 11.4412637072806, 11.7367046978334, 11.4415759938265, 
    11.461789360977, 11.5025221397458, 11.6741375647481, 11.6318730203337, 
    11.8724788742072, 11.3411139466139, 11.193895333642, 11.5090212617708, 
    11.4766156814582, 11.3025257977669, 11.6887687898236, 11.9785619762261, 
    11.5832745795798, 11.5638848196105, 11.6373626595557, 11.5346618451343, 
    11.8053599896049, 11.7866836352087, 11.6656448470497, 11.6767793846651, 
    11.4386961150224, 11.6601979255714, 11.6835301301195, 11.1916085178821, 
    11.3638143635823, 11.5384570024637, 11.5021355520758, 11.728807679399, 
    10.984378479658, 11.7213214603164, 10.7461781085464, 11.3870533808756, 
    11.6264922619532, 11.5206029097705, 11.3075447476347, 11.5292525213332, 
    11.4474539160496, 11.1784758708234, 11.3896979535097, 11.719541623793, 
    11.6053073443453, 11.518232072859, 11.3712640382737, 11.6098940705145, 
    11.5382560364661, 11.7993666879693, 11.6324840910319, 11.4481893420571, 
    11.541204261907, 11.5773112599797, 11.5737901104302, 11.4341925128839, 
    11.4793732048958, 11.6786469969964, 11.779820125404, 11.531459246292, 
    11.2534419833243, 11.5242285802331, 11.7505344377909, 11.2561748020822, 
    11.4661314501832, 11.4760530705387, 11.4506126062349, 11.3963732165445, 
    11.4312630670097, 11.3557616131191, 11.5823565060607, 11.5363888326256, 
    11.4917903826409, 11.5703392588785, 11.4208903235975, 11.3264983504393, 
    11.4339118777607, 11.6207177601068, 12.0732854180863, 11.3485270565549, 
    11.7214183450559, 11.3500282028636, 11.2190693389911, 11.2069248306124, 
    11.6847250769785, 11.7484631837051, 11.3928718561409, 11.0483431329695, 
    11.0632555553734, 11.3484711276532, 11.3540665678888, 11.424901501236, 
    11.3772438391331, 11.3402755457535, 11.6658488666932, 11.801777190057, 
    11.2024789759482, 11.2178942545725, 11.4553053426658, 11.7871905188347, 
    11.4981479663863, 11.327302970811, 11.4159310930165, 11.5560442202663, 
    11.7365037432332, 11.3378278539107, 11.8208625963249, 11.6497566272874, 
    11.5075152494812, 11.5215250880463, 11.2812669600297, 11.310753285262, 
    11.9620678652502, 11.3590587863734, 11.3898381131715, 11.2529331118846, 
    11.2362185790092, 11.385351174977, 11.5744685353361, 11.4856804686762, 
    11.913912055332, 11.3767849155427, 11.8094735607357, 11.1508024267808, 
    11.8106804361006, 11.5470001967063, 11.3952593838908, 11.2484965135934, 
    11.1152705518813, 11.5389406080853, 11.7634503537939, 11.4291028317061, 
    11.3276572999105, 11.4930118360099, 11.5469649014856, 11.5169350020809, 
    11.3285353226113, 11.2780234904709, 11.440289000834, 11.220111220716, 
    11.6368461254189, 11.3373985461442, 11.5729909942026, 11.5627913514537, 
    11.896010438462, 12.1378927192053, 11.2661668881932, 11.6500397905937, 
    11.9456515880464, 11.6036046289927, 11.2617034688574, 11.2041718173304, 
    11.7846555949065, 11.7468241221256, 11.5711643637382, 11.4605756512852, 
    11.6855846792033, 11.610560314245, 11.4023298726094, 11.5935010737646, 
    11.4794267316669, 11.4177936724899, 11.3170444087192, 11.4297981291346, 
    11.5846912793348, 11.5361273182454, 11.2836990730896, 11.7129292407643, 
    11.3682617291422, 11.5788574326573, 11.3656467657476, 11.4105589568224, 
    11.6329782469737, 11.7741760320124, 11.5877677859266, 11.4614478490663, 
    11.8922989610443, 11.4769174598707, 11.5473094994925, 11.8164122469798, 
    11.3965297469094, 11.7060351811225, 11.9160697996983, 12.2091231955421, 
    11.4513840897352, 11.9190686799799, 11.5716373917844, 11.4552839479779, 
    11.2069385588086, 11.2352938786398, 11.4799962344234, 11.1715703387231, 
    11.5951806551894, 11.4965967805174, 11.9066684684352, 12.085620305792, 
    11.6762460737526, 11.5003622406498, 11.2467259944484, 11.3576209222196, 
    11.5538967776043, 11.6021728438367, 11.4017677191272, 11.6541203471886, 
    11.5179908661979, 11.3731766103249, 11.284667844589, 11.277379710151, 
    11.6083662721441, 11.4137354186957, 10.8955839097348, 11.6128481523168, 
    10.9414889550394, 11.500934449099, 11.4032494506259, 11.3414275766532, 
    11.6103518032939, 11.4489716827269, 11.4521528606091, 11.4586955357924, 
    11.0442737725854, 11.4024077316865, 11.4530826810189, 11.2142229985889, 
    11.3211367494156, 11.7695143207915, 11.6801094326193, 11.378714542138, 
    11.5894285425463, 11.4535592112896, 11.5189077909302, 11.905529468508, 
    11.7308595111171, 11.1561241580823, 11.5396607072055, 11.5670558138667, 
    11.5866534877845, 11.4899696625367, 10.7606650890848, 11.4623034225546, 
    11.4829861663367, 11.531027241558, 11.1284027924671, 11.3789406141285, 
    11.7180842406464, 11.248060386135, 11.8557680503442, 11.4749711791423, 
    11.7731267020686, 11.4451020052469, 11.5536039362763, 11.2295030702308, 
    11.4439680242462, 11.3599366494965, 11.2375779084626, 11.4027090068517, 
    11.4674002049422, 11.6107908879673, 11.3646653036025, 11.3525677125419, 
    11.6956920927681, 11.5949761789213, 11.4279470409673, 11.628194983154, 
    11.3797989564061, 11.4537211190876, 11.544720822699, 11.3477447726164, 
    11.5106910979557, 11.2705155562627, 11.5419354593303, 11.6002427009366, 
    11.3617284216845, 11.4545380023049, 11.5559785868196, 11.2827575037312, 
    11.4923949055435, 11.4670902548463, 11.7775808724294, 11.7524650925602, 
    11.5232395955812, 11.7716348213617, 11.3129441491383, 11.9184159519933, 
    11.4651302298193, 11.4828115364529, 11.4921553448102, 11.4840394509425, 
    11.4795329119155, 11.3557617727837, 11.1990802135024, 11.555895890632, 
    11.5665334157256, 11.9608405697218, 11.0906137231452, 11.4738335300962, 
    11.5552267798845, 11.4917532448646, 11.4767501205378, 11.309257136722, 
    11.8330397760739, 11.2452007264035, 11.5626653665188, 11.6615348431299, 
    11.4036383205713, 11.9206466284402, 11.4028117349485, 11.232335830704, 
    11.5710019223606, 11.2323436049941, 11.0986236955492, 11.7618238628064, 
    11.3445348352561, 11.378093136043, 11.5381912190455, 11.282570495449, 
    11.3186759511659, 11.4117838917907, 11.6227635225452, 11.7844213221872, 
    11.5671587969278, 11.458922182513, 11.4032992701995, 11.5491884538217, 
    11.2758671228542, 11.6770897492982, 11.6342313067151, 11.1237574188463, 
    11.6031081273673, 12.1290653063871, 11.4778345922648, 11.3583463804655, 
    11.3266052031506, 11.7246123353123, 11.4647737955044, 11.5883332972292, 
    11.4248310030985, 11.3713918308266, 11.2041509548359, 11.617616628905, 
    11.3759381668148, 11.3305920225639, 11.6871369457011, 11.6303021419011, 
    11.4931674583361, 11.0922966074434, 11.2490842937364, 10.9403583083204, 
    11.1716989237958, 11.4292855836507, 11.6236233194597, 11.5989208423244, 
    11.2147889962406, 11.625607143598, 11.8748838328963, 11.5414934062674, 
    11.6259439615824, 11.3364532857374, 11.8227344400673, 11.7111666222959, 
    11.3727104334305, 11.7078155455392, 11.5544569070194, 11.6021540153749, 
    11.573369065866, 10.8581859655439, 11.6615357936139, 11.6074293122824, 
    11.3800328287919, 11.8608121046055, 10.8695335671074, 11.4549460213617, 
    11.6732793086444, 11.6280582434249, 11.7938110746401, 11.2759355094693, 
    11.7333174374389, 11.5124908292672, 11.5116966042338, 11.2557414497685, 
    11.111003192477, 11.7723687553069, 11.5311536361956, 11.415675250247, 
    11.434958888026, 11.5764304335137, 11.3184428704269, 11.5925005193847, 
    11.6606221243124, 11.6799864503813, 11.6680624812246, 11.6323392171622, 
    11.6205668223306, 11.2743893579799, 11.3038169041637, 11.2516179608122, 
    11.0913550278671, 11.5183036046645, 11.6088540037091, 11.4237385957101, 
    11.7411183714493, 11.5268255736499, 11.5514313428383, 11.4939244996735, 
    11.478671143305, 11.5506137782508, 11.4838342763386, 11.9082590797765, 
    10.960554474782, 11.4510734836701, 11.594720494906, 11.6435287600618, 
    11.4730994130636, 11.6753147493462, 11.0704918909154, 11.3363906264414, 
    11.4069381361204, 11.3390189388972, 11.7394581174949, 11.5025933598415, 
    11.5091568374427, 11.8189657846627, 11.6762535202989, 11.4862855869735, 
    11.5191142470272, 11.4087780398663, 11.5361396738411, 11.3477626341929, 
    11.3295447034612, 11.6461819581215, 11.3160562372171, 11.9732839905477, 
    11.2597545419879, 11.6483236285684, 11.6659329899876, 11.3375985127992, 
    11.5652927769658, 11.5402126667346, 11.5246347656743, 11.3790534415256, 
    11.3504467491437, 11.9006774473653, 11.2998434728114, 11.294215001317, 
    11.0352592725904, 11.5442750193934, 11.9540286929111, 11.5849472177449, 
    11.8695269797079, 11.2221940781463, 11.5391494901798, 11.7652998758852, 
    11.7152214736869, 11.6161349733777, 11.3455362974154, 11.3697013696593, 
    11.6159930311664, 11.5192522836597, 11.3626732407949, 11.7915655615128, 
    10.8468085570926, 11.5051760134024, 11.3931245756523, 11.6445146662936, 
    11.3470732268861, 11.6515019252136, 11.5141257439709, 11.2773011669151, 
    11.3032998105644, 11.7571007839257, 11.3544692125066, 11.5818232930408, 
    11.0839805881239, 11.8582789073051, 11.5997729156958, 11.5897058738691, 
    11.4193569373722, 11.8678858552685, 11.6051915096343, 11.3371558507094, 
    11.3210764775439, 11.3670660935708, 10.9736909230005, 11.5134036283058, 
    11.7378869878075, 11.6101540643963, 11.5960760408688, 11.5398373831802, 
    11.6921293527264, 11.0056293583308, 11.3779618825627, 11.4358858630188, 
    11.3398108548088, 11.500395429923, 11.6290788048495, 11.4534379910937, 
    11.3973526125132, 11.8090228812056, 11.4349697688751, 11.4120105561733, 
    11.2768023713792, 11.6479180048227, 11.8538348852147, 11.2816551787507, 
    11.5483270246353, 11.5002183838825, 11.3020898934751, 11.5115149415805, 
    11.2017560031151, 11.352225955946, 11.6826296693967, 11.8553332139932, 
    11.9042883574032, 11.0560549115389, 11.1767099828818, 11.421709850191, 
    11.702545464272, 11.7485923966285, 11.8047860348248, 11.4448541804893, 
    11.4705435703147, 11.716935272144, 10.9954029806633, 11.1256601239288
  ))
  set.seed(100)
  fit <- ssd_fit_dists(data = data, dists = 'lnorm_lnorm', at_boundary_ok=TRUE, min_pmix = 3/nrow(data))
  tidy <- tidy(fit)
  expect_snapshot_data(tidy, "tidy_lnorm_lnorm_uni1000_3n", digits = 6)
})
