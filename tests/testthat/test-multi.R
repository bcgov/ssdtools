test_that("wt_est_nest works", {
  fit <- ssd_fit_dists(data = ssddata::ccme_boron)
  wt_est <- ssd_wt_est(fit)
  expect_identical(check_wt_est(wt_est), wt_est)
})

test_that("ssd_pmulti", {
  fit <- ssd_fit_dists(data = ssddata::ccme_boron)
  wt_est <- ssd_wt_est(fit)
  expect_equal(ssd_pmulti(numeric(0), wt_est), numeric(0))
  expect_equal(ssd_pmulti(0, wt_est), 0)
  expect_equal(ssd_pmulti(1, wt_est), 0.039138070998897)
  expect_equal(ssd_pmulti(10000, wt_est), 0.999886924828857)
  expect_equal(ssd_pmulti(c(1,2), wt_est), c(0.039138070998897, 0.0837793609527278))
  expect_equal(ssd_pmulti(1, wt_est, lower.tail = FALSE),  1-0.039138070998897)
  expect_equal(ssd_pmulti(1, wt_est, log.p = TRUE), log(0.039138070998897))
  expect_equal(ssd_pmulti(1, wt_est, lower.tail = FALSE, log.p = TRUE),  log(1-0.039138070998897))
})

test_that("ssd_qmulti", {
  fit <- ssd_fit_dists(data = ssddata::ccme_boron)
  wt_est <- ssd_wt_est(fit)
  expect_equal(ssd_qmulti(numeric(0), wt_est), numeric(0))
  expect_equal(ssd_qmulti(0, wt_est), 0)
  expect_equal(ssd_qmulti(0.5, wt_est), 15.3258029969365)
  expect_equal(ssd_qmulti(c(0.5, 0.75), wt_est), c(15.3258029969365, 32.4740415684506))
  expect_equal(ssd_qmulti(0.25, wt_est, lower.tail = FALSE), 32.4740415684506)
  expect_equal(ssd_qmulti(log(0.75), wt_est, log.p = TRUE), 32.4740415684506)
  expect_equal(ssd_qmulti(log(0.25), wt_est, lower.tail = FALSE, log.p = TRUE), 32.4740415684506)
})

test_that("ssd_rmulti", {
  fit <- ssd_fit_dists(data = ssddata::ccme_boron)
  wt_est <- ssd_wt_est(fit)
  expect_equal(ssd_rmulti(0, wt_est), numeric(0))
  set.seed(99)
  expect_equal(ssd_rmulti(1, wt_est), 19.7526820778229)
  set.seed(99)
  expect_equal(ssd_rmulti(2, wt_est), c(19.7526820778229, 2.69560596071394))
  set.seed(99)
  n100 <- ssd_rmulti(100, wt_est)
  expect_identical(length(n100), 100L)
  expect_equal(min(n100), 0.0295662142336016)
  expect_equal(max(n100), 168.790837817766)
  expect_equal(mean(n100), 23.4076759062162)
})
